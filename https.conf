upstream php-handler {
    server cloud:9000;
}

server  {
  server_name "";

  include ssl.conf;
  include headers.conf;

  root /var/www/html;

  access_log /var/log/nginx/access.log main;
  error_log /var/log/nginx/errors.log warn;

  client_max_body_size 10G;
  fastcgi_buffers 64 4K;

  location / {
    rewrite ^ /index.php$request_uri;
  }

  location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/ {
    deny all;
  }
  location ~ ^/(?:\.|autotest|occ|issue|indie|db_|console) {
    deny all;
  }

  location ~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+)\.php(?:$|/) {
    fastcgi_pass php-handler;
    include fastcgi.conf;
  }

  location ~ ^/(?:updater|ocs-provider)(?:$|/) {
    try_files $uri/ =404;
    index index.php;
  }

  location ~ \.(?:css|js|woff2?|svg|gif)$ {
    try_files $uri /index.php$request_uri;
    access_log off;
  }

  location ~ \.(?:png|html|ttf|ico|jpg|jpeg)$ {
    try_files $uri /index.php$request_uri;
    access_log off;
  }
}
